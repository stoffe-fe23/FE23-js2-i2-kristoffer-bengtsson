class e{#e;#t;constructor(e,t=""){this.#e=e,this.#t=t}async getJson(e="",t=null){let r=await fetch(this.#r(e,t)),s=await r.json();return r.ok||this.#s(r,s),s}async postJson(e="",t=null,r=null){let s=await fetch(this.#r(e,r),this.#a("POST",t??{})),a=await s.json();return s.ok||this.#s(s,a),a}async updateJson(e="",t=null,r=null){let s=await fetch(this.#r(e,r),this.#a("PATCH",t??{})),a=await s.json();return s.ok||this.#s(s,a),a}async deleteJson(e="",t=null,r=null){let s=await fetch(this.#r(e,r),this.#a("DELETE",t??{})),a=await s.json();return s.ok||this.#s(s,a),a}formdataToJson(e){var t={};return e instanceof FormData&&e.forEach((e,r)=>{let s=isNaN(e)?e:parseInt(e);s="true"===s||"false"!==s&&s,r in t?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(s)):t[r]=s}),JSON.stringify(t)}#s(e,r){if(400==e.status){if(r.error&&r.data&&"Validation error"==r.error){if(Array.isArray(r.data)){let s="<ul>";if(r.data.length)for(let e of r.data)s+=`<li>${e.msg??"No message"}</li>`;else s+=`<li>${r.error}</li>`;throw s+="</ul>",new t(e.status,s)}}else throw new t(e.status,`API Error: ${r.error??""}  (${e.statusText})`)}else if(500==e.status)throw new t(e.status,`API Error: ${r.error??""}  (${e.statusText})`);else throw new t(e.status,`API Error: ${e.statusText}`)}#r(e="",t=null){let r=new URL(`${this.#e}${e.length?"/"+e:""}${this.#t}`);if(t)for(let e in t)r.searchParams.append(e,t[e]);return r}#a(e,t){return{method:e,headers:{"Content-Type":"application/json"},body:t instanceof FormData?this.formdataToJson(t):JSON.stringify(t)}}}class t extends Error{#n;constructor(e,t){super(t),this.#n=e}get errorCode(){return this.#n}}function r(e,t,r=null,n="",o=null,i=!1){var l;let d=document.createElement(e);if(e=e.toLowerCase(),function(e,t=1){return null!=e&&"object"==typeof e&&Object.keys(e).length>=t}(o,1))for(let e in o)d.setAttribute(e,o[e]);if(null!=(l=d)&&n.length>0&&(Array.isArray(n)?l.classList.add(...n):a(n)&&l.classList.add(n)),function(e,t=1){return null!=e&&Array.isArray(e)&&void 0!==e.length&&e.length>=t}(t)){if("ul"==e||"ol"==e)for(let e of t){let t=document.createElement("li");s(t,e,i),d.appendChild(t)}else if("select"==e||"datalist"==e)for(let e of t){let[t,r,a]=e.split("|"),n=document.createElement("option");if(s(n,r??t,i),n.value=t,void 0!==a){let e=d.querySelector(`optgroup[label="${a}"]`);null==e&&((e=document.createElement("optgroup")).label=a,d.appendChild(e)),e.appendChild(n)}else d.appendChild(n)}else s(d,t[0],i)}else if(a(t,1)){if("img"==e)d.alt=t;else if("input"==e&&t.length>0){let e=d,r=document.createElement("label");(d=document.createElement("div")).id=`${e.id}-wrapper`,n.length>0&&d.classList.add((Array.isArray(n)?n[0]:n)+"-wrapper"),r.setAttribute("for",e.id),s(r,t,i),"radio"==e.getAttribute("type")||"checkbox"==e.getAttribute("type")?(r.classList.add("input-box-label"),d.append(e,r)):d.append(r,e)}else s(d,t,i)}return null!=r&&r.appendChild(d),d}function s(e,t,r){r?e.innerHTML=t:e.innerText=t}function a(e,t=1){return null!=e&&void 0!==e.length&&e.length>=t}function n({message:e}){let t=document.querySelector("#errors");t.innerHTML="";let s=r("div","",t,"error-message");r("h2","Error",s),r("div",e,s,"error-box-message",null,!0),r("button","OK",s,"error-close-button").addEventListener("click",e=>{e.currentTarget.closest("dialog").close()}),console.error(e),t.showModal()}function o(e,t,r){let s={"created-time":function(e,t="sv-SE"){let r=new Date(e);return new Intl.DateTimeFormat(t,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(r)}(e.time),"task-text":e.message,"assigned-to":e.assigned??""},a={"data-taskid":e.taskid,"data-time":e.time},n=function(e,t=null,r={},s=null,a=!1){let n=document.getElementById(e).content.firstElementChild.cloneNode(!0);for(let e in r){let t=n.querySelector(`.${e}`);t&&(t[a?"innerHTML":"innerText"]=r[e])}if(s)for(let e in s){let t=n.querySelector(`[${e}]`);n.getAttribute(e)?n.setAttribute(e,s[e]):t&&t.setAttribute(e,s[e])}return t&&t.appendChild(n),n}(`tpl-task-${e.state}`,t,s,a);if(n.classList.add(`color-${e.category}`),r){let e=n.querySelector("form");e&&e.addEventListener("submit",r)}return n}class i{static validStates=["todo","wip","done"];api;socketClient;#o;constructor(t){let r=new URL(t);this.api=new e(t),this.socketClient=new WebSocket(`ws://${r.hostname}:${r.port}/updates`),this.socketClient.addEventListener("message",this.#i.bind(this))}deleteTask(e){this.api.deleteJson(`delete/${e}`).catch(n)}setTaskDone(e){this.api.updateJson(`done/${e}`).catch(n)}assignTask(e){this.api.updateJson("assign",e).catch(n)}addNewTask(e){this.api.postJson("add",e).catch(n)}showTasks(){this.api.getJson("list").then(e=>{let t={};if(i.validStates.forEach(e=>t[e]=document.querySelector(`#tasks-${e}-box`)),Object.values(t).forEach(e=>{e.innerHTML=""}),e.length)for(let r of(e.sort((e,t)=>e.time-t.time),e))o(r,t[r.state],this.#o)}).catch(n)}setOnAssignTaskEvent(e){"function"==typeof e&&(this.#o=e)}#i(e){let t=JSON.parse(e.data),r=document.querySelector(`article[data-taskid="${t.data.taskid}"]`);r&&r.remove(),"deleted"!=t.type&&(o(t.data,document.querySelector(`#tasks-${t.data.state}-box`),this.#o),this.#l())}#l(){i.validStates.forEach(e=>{let t=document.querySelector(`#tasks-${e}-box`);for(let e=1;e<t.children.length;e++){let r=t.children[e],s=e-1;for(;s>=0&&t.children[s].dataset.time>r.dataset.time;)t.children[s+1].after(t.children[s]),s--;t.children[s+1].after(r)}})}}const l=new i("http://localhost:3000/tasks");function d(e){switch(e.type){case"dragstart":e.target.matches("article")&&(e.target.classList.add("dragged"),e.dataTransfer.setData("text",e.target.getAttribute("data-taskid")));break;case"dragend":e.target.matches("article")&&e.target.classList.remove("dragged");break;case"dragover":e.preventDefault();break;case"dragenter":e.currentTarget.classList.add("dragover");break;case"dragleave":e.currentTarget==e.target&&e.currentTarget.classList.remove("dragover");break;case"drop":let t=e.dataTransfer.getData("text");t&&l.setTaskDone(t),e.currentTarget.classList.remove("dragover")}}l.setOnAssignTaskEvent(e=>{e.preventDefault();let t=new FormData(e.currentTarget);t.set("taskid",e.submitter.closest("article").dataset.taskid),l.assignTask(t)}),document.querySelector("#new-task-form").addEventListener("submit",e=>{e.preventDefault();let t=new FormData(e.currentTarget,e.submitter);l.addNewTask(t),e.currentTarget.reset()}),document.querySelector("#tasks-wip-box").addEventListener("submit",e=>{e.preventDefault();let t=e.submitter.closest("article").dataset.taskid;t?l.setTaskDone(t):console.error("Error marking task as done: Task ID not found!")}),document.querySelector("#tasks-done-box").addEventListener("submit",e=>{e.preventDefault();let t=e.submitter.closest("article").dataset.taskid;t?confirm("Are you sure you wish to delete this task?")&&l.deleteTask(t):console.error("Error deleting task: Task ID not found!")}),document.querySelector("#tasks-wip-box").addEventListener("dragstart",d),document.querySelector("#tasks-wip-box").addEventListener("dragend",d),document.querySelector("#tasks-done").addEventListener("dragover",d),document.querySelector("#tasks-done").addEventListener("dragenter",d),document.querySelector("#tasks-done").addEventListener("dragleave",d),document.querySelector("#tasks-done").addEventListener("drop",d),l.showTasks();
//# sourceMappingURL=index.89773645.js.map
