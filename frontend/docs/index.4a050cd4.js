function e(e,t=1){return null!=e&&void 0!==e.length&&e.length>=t}function t(t,s,n=null,a="",o=null,i=!1){var l;let u=document.createElement(t);if(t=t.toLowerCase(),function(e,t=1){return null!=e&&"object"==typeof e&&Object.keys(e).length>=t}(o,1))for(let e in o)u.setAttribute(e,o[e]);if(null!=(l=u)&&a.length>0&&(Array.isArray(a)?l.classList.add(...a):e(a)&&l.classList.add(a)),function(e,t=1){return null!=e&&Array.isArray(e)&&void 0!==e.length&&e.length>=t}(s)){if("ul"==t||"ol"==t)for(let e of s){let t=document.createElement("li");r(t,e,i),u.appendChild(t)}else if("select"==t||"datalist"==t)for(let e of s){let[t,s,n]=e.split("|"),a=document.createElement("option");if(r(a,s??t,i),a.value=t,void 0!==n){let e=u.querySelector(`optgroup[label="${n}"]`);null==e&&((e=document.createElement("optgroup")).label=n,u.appendChild(e)),e.appendChild(a)}else u.appendChild(a)}else r(u,s[0],i)}else if(e(s,1)){if("img"==t)u.alt=s;else if("input"==t&&s.length>0){let e=u,t=document.createElement("label");(u=document.createElement("div")).id=`${e.id}-wrapper`,a.length>0&&u.classList.add((Array.isArray(a)?a[0]:a)+"-wrapper"),t.setAttribute("for",e.id),r(t,s,i),"radio"==e.getAttribute("type")||"checkbox"==e.getAttribute("type")?(t.classList.add("input-box-label"),u.append(e,t)):u.append(t,e)}else r(u,s,i)}return null!=n&&n.appendChild(u),u}function r(e,t,r){r?e.innerHTML=t:e.innerText=t}class s{#e;#t;constructor(e,t=""){this.#e=e,this.#t=t}get url(){return this.#e}async getJson(e="",t=null){let r=this.#r(e,t),s=await fetch(r),n=await s.json();return s.ok||this.#s(s,n),n}async postJson(e,t="",r=null){let s=this.#r(t,r),n={method:"POST",headers:{"Content-Type":"application/json"},body:e instanceof FormData?this.formdataToJson(e):JSON.stringify(e)},a=await fetch(s,n),o=await a.json();return a.ok||this.#s(a,o),o}async updateJson(e,t="",r=null){let s=this.#r(t,r),n={method:"PATCH",headers:{"Content-Type":"application/json"},body:e instanceof FormData?this.formdataToJson(e):JSON.stringify(e)},a=await fetch(s,n),o=await a.json();return a.ok||this.#s(a,o),o}async deleteJson(e,t="",r=null){let s=this.#r(t,r),n={method:"DELETE",headers:{"Content-Type":"application/json"},body:e instanceof FormData?this.formdataToJson(e):JSON.stringify(e)},a=await fetch(s,n),o=await a.json();return a.ok||this.#s(a,o),o}formdataToJson(e){var t={};return e instanceof FormData&&e.forEach((e,r)=>{let s=isNaN(e)?e:parseInt(e);s="true"===s||"false"!==s&&s,r in t?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(s)):t[r]=s}),JSON.stringify(t)}#s(e,t){if(400==e.status){if(t.error&&t.data&&"Validation error"==t.error){if(Array.isArray(t.data)){let r="<ul>";if(t.data.length)for(let e of t.data)r+=`<li>${e.msg??"No message"}</li>`;else r+=`<li>${t.error}</li>`;throw r+="</ul>",new n(e.status,r)}}else throw new n(e.status,`API Error: ${t.error??""}  (${e.statusText})`)}else if(500==e.status)throw new n(e.status,`API Error: ${t.error??""}  (${e.statusText})`);else throw new n(e.status,`API Error: ${e.statusText}`)}#r(e="",t=null){let r=new URL(`${this.#e}${e.length>0?"/"+e:""}${this.#t}`);if(t)for(let e in t)r.searchParams.append(e,t[e]);return r}}class n extends Error{#n;constructor(e,t){super(t),this.#n=e}get errorCode(){return this.#n}}function a(e){let r=document.querySelector("#errors");r.innerHTML="",t("h2","Error",r),t("div",e,r,"error-box-message",null,!0),t("button","OK",r,"error-close-button").addEventListener("click",e=>{e.currentTarget.closest("dialog").close()}),r.showModal()}const o="http://localhost:3000/tasks";function i(){new s(o+"/list").getJson().then(e=>{let r=document.querySelector("#tasks-todo-box"),s=document.querySelector("#tasks-wip-box"),n=document.querySelector("#tasks-done-box");for(let a of(r.innerHTML="",s.innerHTML="",n.innerHTML="",e)){let e=function(e){let r=t("article",e.message,null,["task-box",`color-${e.category}`],{taskid:e.taskid});switch(e.state){case"todo":let s=t("form","",r,"task-assign-form");t("input","",s,"",{placeholder:"Assign task to",type:"text",name:"assigned","min-length":"2","max-length":"20",required:"true"}),t("button","Assign",s),s.addEventListener("submit",l);break;case"wip":t("div",e.assigned,r,"assigned-to");let n=t("div","",r,"task-button-wrapper");t("button","Done Â»",n);break;case"done":t("div",e.assigned,r,"assigned-to");let a=t("div","",r,"task-delete-wrapper");t("button","X",a)}return r}(a);switch(a.state){case"todo":r.appendChild(e);break;case"wip":s.appendChild(e);break;case"done":n.appendChild(e)}}}).catch(e=>{a(e.message)})}function l(e){e.preventDefault();let t=new FormData(e.currentTarget);t.set("taskid",e.submitter.closest("article").getAttribute("taskid")),function(e){new s(o+"/assign").updateJson(e).then(e=>{i()}).catch(e=>{a(e.message)})}(t)}document.querySelector("#debug").addEventListener("click",e=>{let t=new s(o+"/done"),r=new FormData;r.set("taskid","task"),t.updateJson(r).then(e=>{i()}).catch(e=>{a(e.message)})}),i(),document.querySelector("#tasks-wip-box").addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.set("taskid",e.submitter.closest("article").getAttribute("taskid")),function(e){new s(o+"/done").updateJson(e).then(e=>{i()}).catch(e=>{a(e.message)})}(t)}),document.querySelector("#tasks-done-box").addEventListener("submit",e=>{if(e.preventDefault(),confirm("Are you sure you wish to delete this task?")){let t=new FormData;t.set("taskid",e.submitter.closest("article").getAttribute("taskid")),function(e){new s(o+"/delete").deleteJson(e).then(e=>{i()}).catch(e=>{a(e.message)})}(t)}}),document.querySelector("#new-task-form").addEventListener("submit",e=>{e.preventDefault(),function(e){new s(o+"/add").postJson(e).then(e=>{i()}).catch(e=>{a(e.message)})}(new FormData(e.currentTarget,e.submitter))});
//# sourceMappingURL=index.4a050cd4.js.map
