class t{#t;#e;constructor(t,e=""){this.#t=t,this.#e=e}async getJson(t="",e=null){let s=await fetch(this.#s(t,e)),r=await s.json();return s.ok||this.#r(s,r),r}async postJson(t="",e=null,s=null){let r=await fetch(this.#s(t,s),this.#a("POST",e??{})),a=await r.json();return r.ok||this.#r(r,a),a}async updateJson(t="",e=null,s=null){let r=await fetch(this.#s(t,s),this.#a("PATCH",e??{})),a=await r.json();return r.ok||this.#r(r,a),a}async deleteJson(t="",e=null,s=null){let r=await fetch(this.#s(t,s),this.#a("DELETE",e??{})),a=await r.json();return r.ok||this.#r(r,a),a}formdataToJson(t){var e={};return t instanceof FormData&&t.forEach((t,s)=>{let r=isNaN(t)?t:parseInt(t);r="true"===r||"false"!==r&&r,s in e?(Array.isArray(e[s])||(e[s]=[e[s]]),e[s].push(r)):e[s]=r}),JSON.stringify(e)}#r(t,s){if(400==t.status){if(s.error&&s.data&&"Validation error"==s.error){if(Array.isArray(s.data)){let r="<ul>";if(s.data.length)for(let t of s.data)r+=`<li>${t.msg??"No message"}</li>`;else r+=`<li>${s.error}</li>`;throw r+="</ul>",new e(t.status,r)}}else throw new e(t.status,`API Error: ${s.error??""}  (${t.statusText})`)}else if(500==t.status)throw new e(t.status,`API Error: ${s.error??""}  (${t.statusText})`);else throw new e(t.status,`API Error: ${t.statusText}`)}#s(t="",e=null){let s=new URL(`${this.#t}${t.length?"/"+t:""}${this.#e}`);if(e)for(let t in e)s.searchParams.append(t,e[t]);return s}#a(t,e){return{method:t,headers:{"Content-Type":"application/json"},body:e instanceof FormData?this.formdataToJson(e):JSON.stringify(e)}}}class e extends Error{#n;constructor(t,e){super(e),this.#n=t}get errorCode(){return this.#n}}function s(t,e,s=null,n="",o=null,i=!1){var l;let u=document.createElement(t);if(t=t.toLowerCase(),function(t,e=1){return null!=t&&"object"==typeof t&&Object.keys(t).length>=e}(o,1))for(let t in o)u.setAttribute(t,o[t]);if(null!=(l=u)&&n.length>0&&(Array.isArray(n)?l.classList.add(...n):a(n)&&l.classList.add(n)),function(t,e=1){return null!=t&&Array.isArray(t)&&void 0!==t.length&&t.length>=e}(e)){if("ul"==t||"ol"==t)for(let t of e){let e=document.createElement("li");r(e,t,i),u.appendChild(e)}else if("select"==t||"datalist"==t)for(let t of e){let[e,s,a]=t.split("|"),n=document.createElement("option");if(r(n,s??e,i),n.value=e,void 0!==a){let t=u.querySelector(`optgroup[label="${a}"]`);null==t&&((t=document.createElement("optgroup")).label=a,u.appendChild(t)),t.appendChild(n)}else u.appendChild(n)}else r(u,e[0],i)}else if(a(e,1)){if("img"==t)u.alt=e;else if("input"==t&&e.length>0){let t=u,s=document.createElement("label");(u=document.createElement("div")).id=`${t.id}-wrapper`,n.length>0&&u.classList.add((Array.isArray(n)?n[0]:n)+"-wrapper"),s.setAttribute("for",t.id),r(s,e,i),"radio"==t.getAttribute("type")||"checkbox"==t.getAttribute("type")?(s.classList.add("input-box-label"),u.append(t,s)):u.append(s,t)}else r(u,e,i)}return null!=s&&s.appendChild(u),u}function r(t,e,s){s?t.innerHTML=e:t.innerText=e}function a(t,e=1){return null!=t&&void 0!==t.length&&t.length>=e}function n({message:t}){let e=document.querySelector("#errors");e.innerHTML="";let r=s("div","",e,"error-message");s("h2","Error",r),s("div",t,r,"error-box-message",null,!0),s("button","OK",r,"error-close-button").addEventListener("click",t=>{t.currentTarget.closest("dialog").close()}),console.error(t),e.showModal()}class o{static validStates=["todo","wip","done"];api;#o;constructor(e){this.api=new t(e)}deleteTask(t){this.api.deleteJson(`delete/${t}`).then(this.showTasks.bind(this)).catch(n)}setTaskDone(t){this.api.updateJson(`done/${t}`).then(this.showTasks.bind(this)).catch(n)}assignTask(t){this.api.updateJson("assign",t).then(this.showTasks.bind(this)).catch(n)}addNewTask(t){this.api.postJson("add",t).then(this.showTasks.bind(this)).catch(n)}showTasks(){this.api.getJson("list").then(t=>{let e={};if(o.validStates.forEach(t=>e[t]=document.querySelector(`#tasks-${t}-box`)),Object.values(e).forEach(t=>{t.innerHTML=""}),t.length)for(let r of(t.sort((t,e)=>e.time-t.time),t))e[r.state].appendChild(function(t,e){let r=s("article",t.message,null,["task-box",`color-${t.category}`],{taskid:t.taskid});switch(t.state){case"todo":let a=s("form","",r,"task-assign-form");s("input","",a,"",{placeholder:"Assign task to",type:"text",name:"assigned",minlength:"2",maxlength:"20",required:"true"}),s("button","Assign",a),e&&a.addEventListener("submit",e);break;case"wip":s("div",t.assigned,r,"assigned-to");let n=s("div","",r,"task-button-wrapper");s("button","Done Â»",n);break;case"done":s("div",t.assigned,r,"assigned-to");let o=s("div","",r,"task-delete-wrapper");s("button","X",o)}return r}(r,this.#o))}).catch(n)}setOnAssignTaskEvent(t){"function"==typeof t&&(this.#o=t)}}const i=new o("http://localhost:3000/tasks");i.setOnAssignTaskEvent(t=>{t.preventDefault();let e=new FormData(t.currentTarget);e.set("taskid",t.submitter.closest("article").getAttribute("taskid")),i.assignTask(e)}),document.querySelector("#new-task-form").addEventListener("submit",t=>{t.preventDefault();let e=new FormData(t.currentTarget,t.submitter);i.addNewTask(e),t.currentTarget.reset()}),document.querySelector("#tasks-wip-box").addEventListener("submit",t=>{t.preventDefault();let e=t.submitter.closest("article").getAttribute("taskid");e?i.setTaskDone(e):console.error("Error marking task as done: Task ID not found!")}),document.querySelector("#tasks-done-box").addEventListener("submit",t=>{t.preventDefault();let e=t.submitter.closest("article").getAttribute("taskid");e?confirm("Are you sure you wish to delete this task?")&&i.deleteTask(e):console.error("Error deleting task: Task ID not found!")}),i.showTasks();
//# sourceMappingURL=index.93872d53.js.map
